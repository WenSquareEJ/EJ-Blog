"use strict";(()=>{var e={};e.id=990,e.ids=[990],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9261:e=>{e.exports=require("postcss")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},4203:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>l,POST:()=>c});var n=r(9303),o=r(8716),a=r(670),i=r(7070),u=r(474),p=r(7364);async function l(e){let t=new URL(e.url),r=Math.max(parseInt(t.searchParams.get("page")||"1",10),1),s=Math.min(Math.max(parseInt(t.searchParams.get("pageSize")||"10",10),1),50),n=(r-1)*s,o=(0,u.ZP)(),{data:a,error:p,count:l}=await o.from("posts").select("*",{count:"exact"}).eq("status","approved").order("published_at",{ascending:!1}).range(n,n+s-1);return p?i.NextResponse.json({error:p.message},{status:500}):i.NextResponse.json({page:r,pageSize:s,total:l??0,posts:a??[]})}async function c(e){let t=(0,u.ZP)(),{data:r,error:s}=await t.auth.getUser();if(s||!r?.user)return i.NextResponse.json({error:"Not authenticated"},{status:401});let{title:n,content_md:o,content_html:a,content_json:l,content_text:c,tags:m=[],images:d=[]}=await e.json().catch(()=>({}));if(!n||!(o||a||c))return i.NextResponse.json({error:"Missing title or content"},{status:400});let g=c?.trim()??o?.trim()??"",h=a?.trim()??"";h?h=(0,p.bb)(h):o?h=(0,p.c8)(o):g&&(h=(0,p.c8)(g));let x={title:n,content:(o??g)||"",content_html:h||null,content_json:l??null,author_id:r.user.id,status:"pending",tags:m,images:d},{data:f,error:v}=await t.from("posts").insert(x).select().single();return v?i.NextResponse.json({error:v.message},{status:500}):i.NextResponse.json({post:f},{status:201})}let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/posts/route",pathname:"/api/posts",filename:"route",bundlePath:"app/api/posts/route"},resolvedPagePath:"/Users/Wenyu/Documents/GitHub/EJ-Blog/app/api/posts/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:h}=m,x="/api/posts/route";function f(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},7364:(e,t,r)=>{r.d(t,{AJ:()=>l,aW:()=>p,bb:()=>i,c8:()=>u});var s=r(3021),n=r.n(s),o=r(7661);o.TU.setOptions({gfm:!0,breaks:!0});let a={allowedTags:["p","br","strong","em","u","s","blockquote","ul","ol","li","h1","h2","h3","h4","h5","h6","code","pre","a","img","hr"],allowedAttributes:{a:["href","name","target","rel"],img:["src","alt","title","width","height"],"*":["class"]},allowedSchemes:["http","https","mailto"],transformTags:{a:n().simpleTransform("a",{target:"_blank",rel:"noopener noreferrer"},!0)}};function i(e){return n()(e,a)}function u(e){let t=o.TU.parse(e??"");return i("string"==typeof t?t:t.toString())}function p(e){var t;let r=e.content_html?.trim(),s=e.content?.trim(),o="";r?o=i(r):s&&(o=u(s));let a=o?(t=o,n()(t,{allowedTags:[],allowedAttributes:{}}).trim()):s?.trim()??"";return{html:o,text:a}}function l(e,t=180){let r=e.replace(/\s+/g," ").trim();return r.length<=t?r:`${r.slice(0,t).trimEnd()}â€¦`}},474:(e,t,r)=>{r.d(t,{ZP:()=>o});var s=r(1615),n=r(7721);let o=function(){return function(){let e=(0,s.cookies)();return(0,n.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,r,s){e.set({name:t,value:r,...s})},remove(t,r){e.set({name:t,value:"",...r,maxAge:0})}}})}()}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,326,738,702,972,937],()=>r(4203));module.exports=s})();