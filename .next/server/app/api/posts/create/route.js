"use strict";(()=>{var t={};t.id=810,t.ids=[810],t.modules={2934:t=>{t.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:t=>{t.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:t=>{t.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9261:t=>{t.exports=require("postcss")},3685:t=>{t.exports=require("http")},5687:t=>{t.exports=require("https")},5477:t=>{t.exports=require("punycode")},2781:t=>{t.exports=require("stream")},7310:t=>{t.exports=require("url")},9796:t=>{t.exports=require("zlib")},1287:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>d,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{POST:()=>c});var o=r(9303),s=r(8716),i=r(670),a=r(7070),l=r(474),u=r(7364);async function c(t){let e=(0,l.ZP)(),{data:r}=await e.auth.getUser();if(!r?.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});let n=t.headers.get("content-type")??"",o={};if(n.includes("application/json"))o=await t.json().catch(()=>({}));else{let e=await t.formData();o={title:e.get("title")?.toString()??null,content_html:e.get("content_html")?.toString()??null,content_json:function(t){if(!t)return null;try{return JSON.parse(t)}catch(t){return null}}(e.get("content_json")?.toString()),content_text:e.get("content_text")?.toString()??null,content:e.get("content")?.toString()??null,image_url:e.get("image_url")?.toString()??null}}let s=o.title?.trim();if(!s)return a.NextResponse.json({error:"Title is required"},{status:400});let i=o.content_text?.trim()??o.content?.trim()??"",c=o.content_html?.trim()??"";c?c=(0,u.bb)(c):o.content&&o.content.trim()?c=(0,u.c8)(o.content):i&&(c=(0,u.c8)(i));let p={title:s,author_id:r.user.id,image_url:o.image_url??null,content:(o.content??i)||"",content_html:c||null,content_json:o.content_json??null,status:"pending"},{error:m}=await e.from("posts").insert(p);return m?a.NextResponse.json({error:m.message},{status:400}):n.includes("application/json")?a.NextResponse.json({ok:!0},{status:201}):a.NextResponse.redirect(new URL("/",t.url))}let p=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/posts/create/route",pathname:"/api/posts/create",filename:"route",bundlePath:"app/api/posts/create/route"},resolvedPagePath:"/Users/Wenyu/Documents/GitHub/EJ-Blog/app/api/posts/create/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:d}=p,h="/api/posts/create/route";function x(){return(0,i.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:g})}},7364:(t,e,r)=>{r.d(e,{AJ:()=>c,aW:()=>u,bb:()=>a,c8:()=>l});var n=r(3021),o=r.n(n),s=r(7661);s.TU.setOptions({gfm:!0,breaks:!0});let i={allowedTags:["p","br","strong","em","u","s","blockquote","ul","ol","li","h1","h2","h3","h4","h5","h6","code","pre","a","img","hr"],allowedAttributes:{a:["href","name","target","rel"],img:["src","alt","title","width","height"],"*":["class"]},allowedSchemes:["http","https","mailto"],transformTags:{a:o().simpleTransform("a",{target:"_blank",rel:"noopener noreferrer"},!0)}};function a(t){return o()(t,i)}function l(t){let e=s.TU.parse(t??"");return a("string"==typeof e?e:e.toString())}function u(t){var e;let r=t.content_html?.trim(),n=t.content?.trim(),s="";r?s=a(r):n&&(s=l(n));let i=s?(e=s,o()(e,{allowedTags:[],allowedAttributes:{}}).trim()):n?.trim()??"";return{html:s,text:i}}function c(t,e=180){let r=t.replace(/\s+/g," ").trim();return r.length<=e?r:`${r.slice(0,e).trimEnd()}â€¦`}},474:(t,e,r)=>{r.d(e,{ZP:()=>s});var n=r(1615),o=r(7721);let s=function(){return function(){let t=(0,n.cookies)();return(0,o.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:e=>t.get(e)?.value,set(e,r,n){t.set({name:e,value:r,...n})},remove(e,r){t.set({name:e,value:"",...r,maxAge:0})}}})}()}}};var e=require("../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),n=e.X(0,[948,326,738,702,972,937],()=>r(1287));module.exports=n})();