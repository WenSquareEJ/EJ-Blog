"use strict";(()=>{var e={};e.id=810,e.ids=[810],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9261:e=>{e.exports=require("postcss")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},1287:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{POST:()=>p});var o=r(9303),s=r(8716),i=r(670),a=r(7070),l=r(474),u=r(7364),c=r(6525);async function p(e){let t=(0,l.ZP)(),{data:r}=await t.auth.getUser();if(!r?.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});let n=e.headers.get("content-type")??"",o={};if(n.includes("application/json"))o=await e.json().catch(()=>({}));else{let t=await e.formData();o={title:t.get("title")?.toString()??null,content_html:t.get("content_html")?.toString()??null,content_json:function(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}(t.get("content_json")?.toString()),content_text:t.get("content_text")?.toString()??null,content:t.get("content")?.toString()??null,image_url:t.get("image_url")?.toString()??null}}let s=o.title?.trim();if(!s)return a.NextResponse.json({error:"Title is required"},{status:400});let i=o.content_text?.trim()??o.content?.trim()??"",p=o.content_html?.trim()??"";p?p=(0,u.bb)(p):o.content&&o.content.trim()?p=(0,u.c8)(o.content):i&&(p=(0,u.c8)(i));let g=(0,c.BD)(o.tags),d={id:o.id??void 0,title:s,author:r.user.id,image_url:o.image_url??null,content:(o.content??i)||"",content_html:p||null,content_json:o.content_json??null,status:"pending"},{data:m,error:f}=await t.from("posts").insert(d).select("id").single();if(f)return a.NextResponse.json({error:f.message},{status:400});if(m?.id){let e=await (0,c.Zl)(t,m.id,g);if(e.error)return a.NextResponse.json({error:e.error},{status:500})}return n.includes("application/json")?a.NextResponse.json({ok:!0},{status:201}):a.NextResponse.redirect(new URL("/",e.url))}let g=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/posts/create/route",pathname:"/api/posts/create",filename:"route",bundlePath:"app/api/posts/create/route"},resolvedPagePath:"/Users/Wenyu/Documents/GitHub/EJ-Blog/app/api/posts/create/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:f}=g,h="/api/posts/create/route";function x(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},7364:(e,t,r)=>{r.d(t,{AJ:()=>c,aW:()=>u,bb:()=>a,c8:()=>l});var n=r(3021),o=r.n(n),s=r(7661);s.TU.setOptions({gfm:!0,breaks:!0});let i={allowedTags:["p","br","strong","em","u","s","blockquote","ul","ol","li","h1","h2","h3","h4","h5","h6","code","pre","a","img","hr"],allowedAttributes:{a:["href","name","target","rel"],img:["src","alt","title","width","height"],"*":["class"]},allowedSchemes:["http","https","mailto"],transformTags:{a:o().simpleTransform("a",{target:"_blank",rel:"noopener noreferrer"},!0)}};function a(e){return o()(e,i)}function l(e){let t=s.TU.parse(e??"");return a("string"==typeof t?t:t.toString())}function u(e){var t;let r=e.content_html?.trim(),n=e.content?.trim(),s="";r?s=a(r):n&&(s=l(n));let i=s?(t=s,o()(t,{allowedTags:[],allowedAttributes:{}}).trim()):n?.trim()??"";return{html:s,text:i}}function c(e,t=180){let r=e.replace(/\s+/g," ").trim();return r.length<=t?r:`${r.slice(0,t).trimEnd()}â€¦`}},474:(e,t,r)=>{r.d(t,{ZP:()=>s});var n=r(1615),o=r(7721);let s=function(){return function(){let e=(0,n.cookies)();return(0,o.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(){},remove(){}}})}()}},6525:(e,t,r)=>{function n(e){if(!Array.isArray(e))return[];let t=new Set,r=[];for(let n of e){if("string"!=typeof n)continue;let e=n.trim().toLowerCase();if(e&&!(e.length>20)&&!t.has(e)&&(r.push(e),t.add(e),r.length>=12))break}return r}async function o(e,t,r){if(!t||0===r.length)return{tags:[],error:null};let n=r.map(e=>{let t=e.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,50);return t?{name:e,slug:t}:null}).filter(e=>!!e);if(0===n.length)return{tags:[],error:null};let{data:o,error:s}=await e.from("tags").upsert(n,{onConflict:"slug"}).select("id, name, slug");if(s)return{tags:[],error:s.message};let i=(o??[]).map(e=>e.id?{id:e.id,name:e.name,slug:e.slug}:null).filter(e=>!!e);if(0===i.length)return{tags:[],error:null};let a=i.map(e=>({post_id:t,tag_id:e.id})),{error:l}=await e.from("post_tags").upsert(a,{onConflict:"post_id,tag_id"});return l?{tags:i,error:l.message}:{tags:i,error:null}}r.d(t,{BD:()=>n,Zl:()=>o})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,326,738,702,972,937],()=>r(1287));module.exports=n})();