(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[260],{4664:function(e,t,s){Promise.resolve().then(s.bind(s,5420))},5420:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var n=s(7437),a=s(2265),r=s(6463),l=s(3705),c=s(2214),i=s(824),o=s(5904),d=s.n(o),u=s(1180);function m(e){let{onUploaded:t}=e,[s,r]=(0,a.useState)(null),[l,c]=(0,a.useState)(null),[i,o]=(0,a.useState)(!1),d=(0,u.ZP)();async function m(){if(!s||i)return;o(!0);let e="".concat(Date.now(),"-").concat(s.name.replace(/\s+/g,"_")),{data:n,error:a}=await d.storage.from("images").upload(e,s,{upsert:!1});if(a){console.error(a),alert("Upload failed: ".concat(a.message)),o(!1);return}let{data:r}=d.storage.from("images").getPublicUrl(n.path);c(r.publicUrl),null==t||t(n.path,r.publicUrl),o(!1)}return(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t,s;return r(null!==(s=null===(t=e.target.files)||void 0===t?void 0:t[0])&&void 0!==s?s:null)},className:"block"}),(0,n.jsx)("button",{type:"button",onClick:m,disabled:!s||i,className:"btn-mc",children:i?"Uploading…":"Upload"}),l&&(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("div",{className:"text-xs",children:"Uploaded:"}),(0,n.jsx)("a",{href:l,target:"_blank",rel:"noreferrer",className:"underline break-all",children:l}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)("img",{src:l,alt:"Uploaded preview",className:"max-w-xs border"})})]})]})}function p(){var e;let t=(0,r.useRouter)(),[s,o]=(0,a.useState)(""),[u,p]=(0,a.useState)(null),[x,b]=(0,a.useState)("<p></p>"),[h,g]=(0,a.useState)(null),[f,N]=(0,a.useState)(""),[j,v]=(0,a.useState)(!1),[k,y]=(0,a.useState)(null),[S,w]=(0,a.useState)(!1),_=(0,l.jE)({extensions:[c.Z.configure({heading:{levels:[1,2,3,4]}}),i.ZP.configure({openOnClick:!0,linkOnPaste:!0})],onUpdate(e){let{editor:t}=e;b(t.getHTML()),g(t.getJSON()),N(t.getText({blockSeparator:"\n"}))},editorProps:{attributes:{class:"tiptap prose prose-sm sm:prose-base max-w-none focus:outline-none"}}}),P=(0,a.useCallback)(async e=>{if(e.preventDefault(),!_)return;let n=s.trim();if(!n){y("Please add a title before publishing.");return}let a=x||_.getHTML(),r=null!=h?h:_.getJSON(),l=f||_.getText({blockSeparator:"\n"});if(!l.trim()){y("Write something before publishing.");return}w(!0),y(null);try{let e=await fetch("/api/posts/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:n,image_url:u,content_html:a,content_json:r,content_text:l})});if(!e.ok){var c;let t=await e.json().catch(()=>({}));y(null!==(c=t.error)&&void 0!==c?c:"Unable to save the post. Try again.");return}y("Post submitted for approval! Redirecting…"),setTimeout(()=>{t.push("/"),t.refresh()},1200)}catch(e){y(e instanceof Error?e.message:"Unknown error.")}finally{w(!1)}},[h,_,x,u,t,f,s]);return(0,n.jsxs)("div",{className:"space-y-5",children:[(0,n.jsxs)("header",{className:"flex items-center justify-between",children:[(0,n.jsx)("h1",{className:"font-mc text-lg sm:text-xl",children:"Create New Post"}),(0,n.jsxs)("div",{className:"inline-flex items-center gap-2 rounded border-2 border-mc-wood-dark bg-mc-sand/50 p-1",children:[(0,n.jsx)("button",{type:"button",onClick:()=>v(!1),className:"btn-mc-secondary px-3 py-1 ".concat(j?"":"ring-2 ring-mc-wood-dark"),children:"Editor"}),(0,n.jsx)("button",{type:"button",onClick:()=>v(!0),className:"btn-mc-secondary px-3 py-1 ".concat(j?"ring-2 ring-mc-wood-dark":""),children:"Preview"})]})]}),(0,n.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-xs uppercase tracking-[0.18em] text-mc-stone",children:"Title"}),(0,n.jsx)("input",{name:"title",type:"text",value:s,onChange:e=>o(e.target.value),placeholder:"Post title",className:"w-full rounded-md border-2 border-mc-wood-dark bg-mc-parchment px-3 py-2 font-pixel text-sm text-mc-dirt focus:outline-none focus:ring-2 focus:ring-mc-wood",required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-xs uppercase tracking-[0.18em] text-mc-stone",children:"Content"}),(0,n.jsx)("div",{className:"rounded-md border-2 border-mc-wood-dark bg-mc-parchment p-3",children:j?(0,n.jsx)("article",{className:"prose prose-sm sm:prose-base max-w-none text-mc-dirt",dangerouslySetInnerHTML:{__html:(e=x||"<p><em>Nothing yet…</em></p>",d().sanitize(e))}}):(0,n.jsx)(l.kg,{editor:_})})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"block text-xs uppercase tracking-[0.18em] text-mc-stone",children:"Featured Image"}),(0,n.jsx)(m,{onUploaded:(e,t)=>p(t)}),u&&(0,n.jsxs)("p",{className:"text-xs text-mc-stone",children:["Selected image: ",u]})]}),k&&(0,n.jsx)("p",{className:"text-sm text-red-600",children:k}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{type:"submit",className:"btn-mc",disabled:S,children:S?"Publishing…":"Publish"}),(0,n.jsx)("button",{type:"button",className:"btn-mc-secondary",onClick:()=>null==_?void 0:_.commands.clearContent(!0),disabled:S,children:"Clear"})]})]})]})}},1180:function(e,t,s){"use strict";s.d(t,{V4:function(){return l}});var n=s(5609),a=s(357);let r=null;function l(){return r||(r=(0,n.createBrowserClient)(a.env.NEXT_PUBLIC_SUPABASE_URL,a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY))}t.ZP=l}},function(e){e.O(0,[572,902,184,487,971,23,744],function(){return e(e.s=4664)}),_N_E=e.O()}]);