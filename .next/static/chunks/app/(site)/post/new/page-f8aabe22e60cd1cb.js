(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[260],{4664:function(e,t,s){Promise.resolve().then(s.bind(s,5420))},5420:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var a=s(7437),n=s(2265),r=s(6463),l=s(3705),c=s(2214),o=s(824),i=s(5904),d=s.n(i),u=s(1180);function m(e){let{onUploaded:t}=e,[s,r]=(0,n.useState)(null),[l,c]=(0,n.useState)(null),[o,i]=(0,n.useState)(!1),d=(0,u.ZP)();async function m(){if(!s||o)return;i(!0);let e="".concat(Date.now(),"-").concat(s.name.replace(/\s+/g,"_")),{data:a,error:n}=await d.storage.from("images").upload(e,s,{upsert:!1});if(n){console.error(n),alert("Upload failed: ".concat(n.message)),i(!1);return}let{data:r}=d.storage.from("images").getPublicUrl(a.path);c(r.publicUrl),null==t||t(a.path,r.publicUrl),i(!1)}return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t,s;return r(null!==(s=null===(t=e.target.files)||void 0===t?void 0:t[0])&&void 0!==s?s:null)},className:"block"}),(0,a.jsx)("button",{type:"button",onClick:m,disabled:!s||o,className:"btn-mc",children:o?"Uploading…":"Upload"}),l&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"text-xs",children:"Uploaded:"}),(0,a.jsx)("a",{href:l,target:"_blank",rel:"noreferrer",className:"underline break-all",children:l}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("img",{src:l,alt:"Uploaded preview",className:"max-w-xs border"})})]})]})}function p(){var e;let t=(0,r.useRouter)(),[s,i]=(0,n.useState)(""),[u,p]=(0,n.useState)(null),[x,g]=(0,n.useState)("<p></p>"),[h,b]=(0,n.useState)(null),[f,N]=(0,n.useState)(""),[j,k]=(0,n.useState)(!1),[v,y]=(0,n.useState)(null),[w,S]=(0,n.useState)(!1),[C,_]=(0,n.useState)([]),[P,U]=(0,n.useState)(""),[T,E]=(0,n.useState)(null),O=e=>e.trim().toLowerCase(),L=(0,l.jE)({extensions:[c.Z.configure({heading:{levels:[1,2,3,4]}}),o.ZP.configure({openOnClick:!0,linkOnPaste:!0})],onUpdate(e){let{editor:t}=e;g(t.getHTML()),b(t.getJSON()),N(t.getText({blockSeparator:"\n"}))},editorProps:{attributes:{class:"tiptap prose prose-sm sm:prose-base max-w-none focus:outline-none"}}}),B=(0,n.useCallback)(async e=>{if(e.preventDefault(),!L)return;let a=s.trim();if(!a){y("Please add a title before publishing.");return}let n=x||L.getHTML(),r=null!=h?h:L.getJSON(),l=f||L.getText({blockSeparator:"\n"});if(!l.trim()){y("Write something before publishing.");return}S(!0),y(null);try{let e=await fetch("/api/posts/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:a,image_url:u,content_html:n,content_json:r,content_text:l,tags:C})});if(!e.ok){var c;let t=await e.json().catch(()=>({}));y(null!==(c=t.error)&&void 0!==c?c:"Unable to save the post. Try again.");return}y("Post submitted for approval! Redirecting…"),setTimeout(()=>{t.push("/"),t.refresh()},1200)}catch(e){y(e instanceof Error?e.message:"Unknown error.")}finally{S(!1)}},[h,L,x,u,t,C,f,s]);return(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"font-mc text-lg sm:text-xl",children:"Create New Post"}),(0,a.jsxs)("div",{className:"inline-flex items-center gap-2 rounded border-2 border-mc-wood-dark bg-mc-sand/50 p-1",children:[(0,a.jsx)("button",{type:"button",onClick:()=>k(!1),className:"btn-mc-secondary px-3 py-1 ".concat(j?"":"ring-2 ring-mc-wood-dark"),children:"Editor"}),(0,a.jsx)("button",{type:"button",onClick:()=>k(!0),className:"btn-mc-secondary px-3 py-1 ".concat(j?"ring-2 ring-mc-wood-dark":""),children:"Preview"})]})]}),(0,a.jsxs)("form",{onSubmit:B,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-xs uppercase tracking-[0.18em] text-mc-stone",children:"Title"}),(0,a.jsx)("input",{name:"title",type:"text",value:s,onChange:e=>i(e.target.value),placeholder:"Post title",className:"w-full rounded-md border-2 border-mc-wood-dark bg-mc-parchment px-3 py-2 font-pixel text-sm text-mc-dirt focus:outline-none focus:ring-2 focus:ring-mc-wood",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-xs uppercase tracking-[0.18em] text-mc-stone",children:"Tags (comma-separated)"}),(0,a.jsx)("input",{type:"text",value:P,onChange:e=>U(e.target.value),onKeyDown:function(e){if("Enter"===e.key||","===e.key)e.preventDefault(),function(e){let t=O(e);if(E(null),t){if(t.length>20){E("Tags must be 1-20 characters long.");return}_(e=>e.length>=12?(E("Limit of 12 tags per post."),e):e.some(e=>e===t)?(E("Duplicate tag."),e):[...e,t]),U("")}}(P);else if("Backspace"===e.key&&""===P&&C.length){e.preventDefault();let t=C[C.length-1];_(e=>e.slice(0,e.length-1)),U(t)}},placeholder:"minecraft, adventure, family",className:"w-full rounded-md border-2 border-mc-wood-dark bg-mc-parchment px-3 py-2 font-pixel text-sm text-mc-dirt focus:outline-none focus:ring-2 focus:ring-mc-wood"}),T&&(0,a.jsx)("p",{className:"text-xs text-red-500",children:T}),C.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:C.map(e=>(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full border border-mc-wood-dark bg-mc-sand/70 px-3 py-1 text-xs uppercase tracking-wide text-mc-wood-dark",children:[(0,a.jsxs)("span",{children:["#",e]}),(0,a.jsx)("button",{type:"button",onClick:()=>{E(null),_(t=>t.filter(t=>t!==e))},className:"rounded-full bg-mc-wood-dark/10 px-1 text-[10px] leading-none text-mc-wood-dark transition hover:bg-mc-wood-dark hover:text-mc-parchment","aria-label":"Remove tag ".concat(e),children:"\xd7"})]},e))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-xs uppercase tracking-[0.18em] text-mc-stone",children:"Content"}),(0,a.jsx)("div",{className:"rounded-md border-2 border-mc-wood-dark bg-mc-parchment p-3",children:j?(0,a.jsx)("article",{className:"prose prose-sm sm:prose-base max-w-none text-mc-dirt",dangerouslySetInnerHTML:{__html:(e=x||"<p><em>Nothing yet…</em></p>",d().sanitize(e))}}):(0,a.jsx)(l.kg,{editor:L})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-xs uppercase tracking-[0.18em] text-mc-stone",children:"Featured Image"}),(0,a.jsx)(m,{onUploaded:(e,t)=>p(t)}),u&&(0,a.jsxs)("p",{className:"text-xs text-mc-stone",children:["Selected image: ",u]})]}),v&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:v}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"submit",className:"btn-mc",disabled:w,children:w?"Publishing…":"Publish"}),(0,a.jsx)("button",{type:"button",className:"btn-mc-secondary",onClick:()=>null==L?void 0:L.commands.clearContent(!0),disabled:w,children:"Clear"})]})]})]})}},1180:function(e,t,s){"use strict";s.d(t,{V4:function(){return l}});var a=s(5609),n=s(357);let r=null;function l(){return r||(r=(0,a.createBrowserClient)(n.env.NEXT_PUBLIC_SUPABASE_URL,n.env.NEXT_PUBLIC_SUPABASE_ANON_KEY))}t.ZP=l}},function(e){e.O(0,[572,902,184,487,971,23,744],function(){return e(e.s=4664)}),_N_E=e.O()}]);