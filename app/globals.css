/* ===== Tailwind (keep at top) ===== */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== XPBar pixel/animation styles ===== */
.pixel-border { box-shadow: 0 2px 0 rgba(0,0,0,0.25); }

@keyframes xpShimmerMove { 0%{background-position:-200% 0} 100%{background-position:200% 0} }
.xp-fill > span {
  background-image: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.7) 50%, rgba(255,255,255,0) 100%);
  background-size: 200% 100%;
}
.animate-xpShimmer { animation: xpShimmerMove 6s linear infinite; }

@keyframes xpPulse { 0%,100%{box-shadow:0 0 0 rgba(47,111,50,0)} 50%{box-shadow:0 0 8px rgba(47,111,50,0.35)} }
.animate-xpPulse { animation: xpPulse 4s ease-in-out infinite; }

@keyframes xpRise { 0%{transform:translate(-50%,0);opacity:0} 20%{opacity:1} 100%{transform:translate(-50%,-12px);opacity:0} }
.animate-xpRise { animation: xpRise 0.8s ease-out forwards; }

.sparkle { width:6px;height:6px;display:inline-block;background:radial-gradient(circle,#fff 0%,#ffe8a3 60%,rgba(255,255,255,0) 70%);filter:drop-shadow(0 0 2px #ffe8a3);border-radius:50% }
@keyframes sparkFade { 0%{opacity:0;transform:translateY(6px) scale(0.8)} 20%{opacity:1} 100%{opacity:0;transform:translateY(-6px) scale(1.1)} }
.animate-sparkFade { animation: sparkFade 1.2s ease-out forwards; }

/* ===== Portal Room Minecraft palette ===== */
.portal-tile.portal-tile-mc {
  background: #d8b87a;
  border: 3px solid #5a3d1a;
  border-radius: 12px;
  box-shadow: 0 4px 0 #5a3d1a;
  color: var(--mc-ink);
  font-family: var(--font-mc), monospace;
  font-weight: bold;
  font-size: 1.1rem;
  transition: background 0.18s, box-shadow 0.18s, transform 0.18s;
}
.portal-tile.portal-tile-mc:hover,
.portal-tile.portal-tile-mc:focus {
  background: #c49a55;
  box-shadow: 0 6px 0 #5a3d1a;
  transform: translateY(-2px) scale(1.03);
}
.portal-tile.portal-tile-mc .portal-title { text-shadow: 1px 1px 0 #fff; }

/* ===== Compact navbar for Home page ===== */
.navbar--compact { padding-top: .25rem !important; padding-bottom: .25rem !important; box-shadow: none !important; }
.navbar--compact .navbar-links { display: none !important; }

/* ===== Portal Room ===== */
.portal-room { margin: 2rem 0 3rem 0; }

/* ===== Avatar House (grid + tile defaults) ===== */
.avatar-grid {
  display: grid;
  gap: 10px;
  grid-template-columns: repeat(auto-fill, minmax(72px, 1fr));
}

/* Keep the container look if you still use `.avatar-tile`,
   but do NOT hard-cap inner <img> to 56Ã—56 anymore. */
.avatar-tile {
  background: var(--mc-parchment);
  border: 2px solid #000;
  border-radius: 10px;
  padding: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: box-shadow .18s, outline .18s;
}
.avatar-tile[aria-pressed="true"] { outline: 3px solid var(--mc-accent, #3c9d3c); box-shadow: 0 0 0 2px #000 inset; }
.avatar-tile:focus { outline: 3px solid var(--mc-accent, #3c9d3c); z-index: 2; }

/* Flexible image: fill the frame naturally */
.avatar-tile img {
  width: 100%;
  height: 100%;
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  border-radius: 6px;
  background: #fff;
  box-shadow: 0 1px 4px rgba(47,39,28,0.10);
}

/* Portal grid */
.portal-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
@media (min-width: 600px) {
  .portal-grid { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
}
.portal-tile {
  position: relative; display: flex; flex-direction: column; justify-content: flex-end;
  min-height: 8rem; border-radius: 1.2rem; background: var(--mc-sky, #b3e6ff);
  box-shadow: 0 2px 8px rgba(47,39,28,0.10); overflow: hidden; text-decoration: none; outline: none;
  transition: box-shadow .2s, transform .2s;
}
.portal-tile:focus { box-shadow: 0 0 0 3px var(--mc-emerald, #2ecc40); z-index: 2; }
.portal-tile:hover:not([aria-disabled="true"]), .portal-tile:focus-visible {
  box-shadow: 0 0 0 3px var(--mc-emerald, #2ecc40), 0 2px 12px rgba(47,39,28,0.18);
  transform: translateY(-2px) scale(1.02);
}
@media (prefers-reduced-motion: reduce) { .portal-tile { transition: none; } }

/* Remove unwanted portal background overlay for Home page */
.portal-bg { display: none !important; }
.portal-content { position: relative; z-index: 1; padding: 1.2rem 1rem 1rem; display: flex; flex-direction: column; align-items: flex-start; }
.portal-title { font-family: var(--font-mc), monospace; color: var(--mc-ink, #2f2618); font-size: 1.25rem; font-weight: bold; margin-bottom: .3rem; }
.portal-subtitle { color: var(--mc-stone, #5b5550); font-size: .95rem; margin-bottom: .2rem; }

/* ===== Badge strip widget styles (unchanged) ===== */
.badge-strip-card { border: 2px solid var(--mc-wood, #4f2f13); background: var(--mc-parchment, #f8f5e9); border-radius: 1rem; padding: .75rem 1rem; box-shadow: 0 2px 8px rgba(47,39,28,0.07); display: flex; flex-direction: column; gap: .5rem; min-width: 0; }
.badge-strip-row { display: flex; gap: .5rem; overflow-x: auto; padding-bottom: 2px; min-height: 2.5rem; }
.badge-strip-icon { width: 2.2rem; height: 2.2rem; font-size: 2rem; display: inline-flex; align-items: center; justify-content: center; border-radius: .5rem; background: none; color: var(--mc-ink, #1f1b14); box-shadow: 0 1px 2px rgba(47,39,28,0.10); transition: box-shadow 120ms; }
.badge-strip-icon:focus { outline: 2px solid var(--mc-wood, #4f2f13); }
.badge-strip-extra { display: inline-flex; align-items: center; justify-content: center; font-size: 1.1rem; color: var(--mc-stone, #7c6f57); background: none; border-radius: .5rem; padding: 0 .5rem; }
.badge-strip-link { font-size: .95rem; color: var(--mc-wood, #4f2f13); text-decoration: underline; margin-top: 2px; align-self: flex-end; }

/* Ensure readable text on light parchment surfaces */
.site-content-surface {
  --mc-ink: #2f2618;
  --mc-stone: #5b5550;
  color: var(--mc-ink);
  border: 0;
  background-color: rgba(254, 252, 245, 0.88);
  box-shadow: 0 18px 42px rgba(20, 20, 20, 0.16);
  padding: clamp(1.5rem, 2vw + 1rem, 2.75rem);
  backdrop-filter: blur(8px);
}
@media (max-width: 768px) {
  .site-content-surface { background-color: rgba(254, 252, 245, 0.90); padding: clamp(1.25rem, 4vw + 1rem, 2rem); }
}

/* Centralized home widget text utilities */
.home-card { border: 4px solid color-mix(in srgb, var(--mc-wood-dark) 92%, #000 8%); border-radius: .75rem; background-color: color-mix(in srgb, var(--mc-parchment) 60%, transparent 40%); backdrop-filter: blur(4px); box-shadow: 0 3px 0 rgba(35, 19, 8, .35), 0 10px 0 rgba(13, 6, 3, .25); }
.home-card-title { font-family: var(--font-mc), monospace; color: var(--mc-ink); font-size: 1.125rem; font-weight: bold; }
.home-card-meta { color: var(--mc-stone); font-size: .75rem; }
.home-card-body { color: var(--mc-ink); font-size: 15px; line-height: 1.6; }

/* Expose custom font utilities so Tailwind @apply can see them */
@layer utilities {
  .font-mc { font-family: var(--font-mc), monospace; }
  .font-pixel { font-family: var(--font-pixel), system-ui, sans-serif; }
}

/* ===== DEFAULT THEME ===== */
:root {
  --mc-grass: #4CAF50;
  --mc-sky:   #87CEEB;
  --mc-ink:   #2f2618;
  --mc-stone: #5b5550;
  --mc-parchment: #f4e7c6;
  --mc-cloud: #eae0b9;
  --mc-wood: #4b2e05;

  --mc-sky-deep: #7fc2ff;
  --mc-sky-light: #bde4ff;

  --mc-tree-dark: #2f5f37;
  --mc-tree-soft: #3c7344;
  --mc-field: #6fbf5f;
  --mc-field-light: #7dd871;
}

/* Targeted tweak for readable text inside content surface */
.site-content-surface .home-card-title,
.site-content-surface .section-title { color: var(--mc-ink); text-shadow: none; }

/* Base body */
html, body { min-height: 100%; background-color: #101820; color: var(--mc-ink); }
@media (max-width: 768px) { html, body { background-attachment: scroll; } }

/* Buttons */
.btn-mc { border: 1px solid black; padding: .5rem .5rem; border-radius: .375rem; font-size: .75rem; font-family: var(--font-mc), monospace; box-shadow: 0 2px 6px rgba(0,0,0,.12); background-color: var(--mc-sky); color: var(--mc-ink); transition: filter .2s; }
.btn-mc:hover { filter: brightness(.9); }
.btn-mc-secondary { border: 1px solid black; padding: .5rem .5rem; border-radius: .375rem; font-size: .75rem; font-family: var(--font-mc), monospace; box-shadow: 0 2px 6px rgba(0,0,0,.12); background-color: var(--mc-parchment); color: var(--mc-ink); transition: background .2s; }
.btn-mc-secondary:hover { background-color: #f4ede0; }
.btn-mc-danger { padding: .5rem .5rem; border-radius: .375rem; font-size: .75rem; font-family: var(--font-mc), monospace; box-shadow: 0 2px 6px rgba(0,0,0,.12); background-color: #dc2626; color: var(--mc-parchment); transition: background .2s; }
.btn-mc-danger:hover { background-color: #b91c1c; }
.btn-mc-primary { border: 1px solid black; padding: .5rem .5rem; border-radius: .375rem; font-size: .75rem; font-family: var(--font-mc), monospace; box-shadow: 0 2px 6px rgba(0,0,0,.12); background-color: var(--mc-accent); color: var(--mc-ink); transition: filter .2s; }
.btn-mc-primary:hover { filter: brightness(.9); }
.btn-mc-parchment { border: 1px solid black; padding: .5rem .5rem; border-radius: .375rem; font-size: .75rem; font-family: var(--font-mc), monospace; box-shadow: 0 2px 6px rgba(0,0,0,.12); background-color: var(--mc-parchment); color: var(--mc-ink); }
.card-block { border: 1px solid black; border-radius: .5rem; padding: .5rem; box-shadow: 0 2px 6px rgba(0,0,0,.12); background-color: var(--mc-parchment); }

/* Banner */
.banner-placeholder { background-color: var(--mc-grass); height: 80px; border-bottom: 2px solid black; }

/* Links */
a { color: var(--mc-link); }
a:hover { text-decoration: underline; }

/* ===== THEME: WOOD ===== */
.theme-wood {
  --mc-grass: #5a3d2b;
  --mc-sky:   #2f4f2f;
  --mc-ink:   #f4f0e6;
  --mc-stone: #7a5230;
  --mc-accent:#3c9d3c;
  --mc-parchment: #f4f0e6;
  --mc-link: #4fa3f7;
  --mc-sky-deep: #6bb3f0;
  --mc-sky-light: #9ed3ff;
  --mc-cloud: #fff9f0;
  --mc-tree-dark: #224028;
  --mc-tree-soft: #2f5a33;
  --mc-field: #4f8f3f;
  --mc-field-light: #68ac53;
}
.theme-wood .card-block { background-color: color-mix(in srgb, var(--mc-parchment) 90%, white 10%); }
.theme-wood .banner-placeholder { background-color: var(--mc-stone); border-bottom: 2px solid #2b1b12; }
.pixel-border { box-shadow: 0 0 0 1px #000, 2px 2px 0 0 rgba(0,0,0,0.2); }
.ai-helper-dock { @apply fixed bottom-4 right-4 rounded-lg shadow-lg border; background-color: var(--mc-stone); color: var(--mc-ink); border-color: #000; }

/* ===== Badges page utilities (unchanged) ===== */
/* ... (keeping all your badge rules as-is) ... */

/* ===== Toasts (unchanged) ===== */
.toast-stack { position: fixed; top: 1.25rem; right: 1.25rem; display: flex; flex-direction: column; gap: .5rem; z-index: 1000; }
.toast-card { display: inline-flex; align-items: center; gap: .5rem; padding: .6rem .8rem; border: 2px solid rgba(79, 47, 19, 0.85); border-radius: .5rem; background: linear-gradient(135deg, rgba(246, 232, 192, 0.95), rgba(235, 216, 168, 0.92)); box-shadow: 0 6px 14px rgba(40, 25, 8, 0.22); font-size: .9rem; color: var(--mc-ink, #1f1b14); animation: toast-pop 160ms ease-out; }
.toast-emoji { font-size: 1.25rem; line-height: 1; }
.toast-message { font-family: var(--font-mc), monospace; letter-spacing: .04em; }
@keyframes toast-pop { from { transform: translateY(-4px) scale(.98); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }

.nav-badge-count {
  display: inline-flex; align-items: center; gap: .25rem; padding: .2rem .5rem;
  border: 2px solid rgba(79, 47, 19, 0.7); border-radius: 9999px; background-color: rgba(252, 244, 209, 0.2);
  font-family: var(--font-mc), monospace; font-size: .75rem; letter-spacing: .06em;
  color: var(--mc-parchment, #f6e8c0); box-shadow: 0 2px 6px rgba(20, 12, 4, 0.25);
}

/* ===== Scenic home background + surface layering ===== */
.home-background {
  position: fixed; inset: 0; z-index: -1; pointer-events: none;
  background: linear-gradient(to bottom, rgba(12,22,32,.6) 0%, rgba(12,22,32,.5) 38%, rgba(19,12,6,.58) 100%);
}

/* ===== PixelBackground overlays ===== */
.pixel-banner { position: absolute; inset: 0; z-index: -2; pointer-events: none; }
.pixel-banner__layer { position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; }
.pixel-banner__sky { background: linear-gradient(to bottom, var(--mc-sky-light) 0%, var(--mc-sky-deep) 100%); opacity: 1; mix-blend-mode: normal; }
.pixel-banner__clouds { opacity: 1; mix-blend-mode: normal; }
.pixel-banner__cloud { display: inline-block; width: 120px; height: 48px; background: var(--mc-cloud); border-radius: 32px; box-shadow: 0 2px 16px rgba(0,0,0,0.08); opacity: 1; mix-blend-mode: normal; }
.pixel-banner__trees { background: linear-gradient(to bottom, var(--mc-tree-dark) 0%, var(--mc-tree-soft) 100%); opacity: 1; mix-blend-mode: normal; }
.pixel-banner__grass { background: linear-gradient(to top, var(--mc-field) 0%, var(--mc-field-light) 100%); opacity: 1; mix-blend-mode: normal; }
.pixel-banner__grass-top { display: block; width: 100%; height: 16px; background: var(--mc-grass); opacity: 1; mix-blend-mode: normal; }
.pixel-banner__dirt { display: block; width: 100%; height: 24px; background: #8b5a2b; opacity: 1; mix-blend-mode: normal; }

@media (max-width: 768px) {
  .home-background {
    background: linear-gradient(to bottom, rgba(12,22,32,.7) 0%, rgba(12,22,32,.55) 45%, rgba(19,12,6,.6) 100%);
  }
}

.site-content-surface {
  position: relative; border-radius: 1.25rem; border: 0;
  background-color: rgba(254, 252, 245, 0.88);
  box-shadow: 0 18px 42px rgba(20,20,20,0.16);
  padding: clamp(1.5rem, 2vw + 1rem, 2.75rem);
  backdrop-filter: blur(8px);
}
@media (max-width: 768px) {
  .site-content-surface { background-color: rgba(254, 252, 245, 0.90); padding: clamp(1.25rem, 4vw + 1rem, 2rem); }
}

/* ===== XP bar structure (unchanged) ===== */
.xp-bar {
  --xp-border: #4a2f1d; --xp-inner: #6b4a2f; --xp-inner-edge: #2d1a10;
  --xp-fill: #4ca84c; --xp-fill-shadow: #2f6f32; --xp-badge: #8b5a35; --xp-badge-text: #f9e9ca;
  display: grid; grid-template-columns: minmax(0, 1fr) auto; grid-template-rows: auto auto;
  grid-template-areas: "track badge" "meta meta"; gap: .5rem .75rem; align-items: center;
  font-family: var(--font-mc), monospace; width: 100%;
}
.xp-bar__track {
  grid-area: track; position: relative; height: 26px;
  border: 4px solid var(--xp-border); background-color: var(--xp-inner);
  box-shadow: inset 0 0 0 2px var(--xp-inner-edge), 0 3px 0 rgba(26,13,5,.45);
  overflow: hidden; border-radius: 6px;
}
.xp-bar__track::before { content: ""; position: absolute; inset: 2px 2px auto 2px; height: 6px; background: rgba(255,255,255,.25); pointer-events: none; }
.xp-bar__fill {
  position: absolute; inset: 2px;
  background: repeating-linear-gradient(90deg, var(--xp-fill) 0px, var(--xp-fill) 12px, var(--xp-fill-shadow) 12px, var(--xp-fill-shadow) 20px);
  border: 3px solid color-mix(in srgb, var(--xp-fill-shadow) 80%, #000 20%);
  border-radius: 4px; box-shadow: inset 0 -3px 0 rgba(0,0,0,.25), inset 0 3px 0 rgba(255,255,255,.25);
  transition: width 220ms ease-out; transform-origin: left center;
}
.xp-bar__badge {
  grid-area: badge; align-self: stretch; min-width: 96px; padding: .4rem .75rem;
  border: 4px solid color-mix(in srgb, var(--xp-border) 80%, #24140a 20%);
  background: repeating-linear-gradient(0deg, color-mix(in srgb, var(--xp-badge) 88%, #6a4427 12%) 0px, color-mix(in srgb, var(--xp-badge) 88%, #6a4427 12%) 8px, color-mix(in srgb, var(--xp-badge) 65%, #4b2c16 35%) 8px, color-mix(in srgb, var(--xp-badge) 65%, #4b2c16 35%) 16px);
  color: var(--xp-badge-text); text-align: center; letter-spacing: .18em; text-transform: uppercase;
  box-shadow: 0 3px 0 rgba(35,19,8,.55), 0 6px 0 rgba(13,6,3,.35);
  display: inline-flex; align-items: center; justify-content: center; font-size: .78rem;
}
.xp-bar__meta { grid-area: meta; font-size: .68rem; letter-spacing: .12em; text-transform: uppercase; color: rgba(46,46,46,.72); }

@media (max-width: 480px) {
  .xp-bar { grid-template-columns: minmax(0, 1fr); grid-template-areas: "track" "badge" "meta"; justify-items: stretch; }
  .xp-bar__badge { justify-self: flex-start; }
}

/* ===== Avatar Glow (GLOBAL) ===== */
.avatar-glow-frame {
  position: relative;
  border-radius: 0.75rem;
  overflow: hidden;
  box-shadow: 0 0 8px rgba(255, 255, 255, 0.1);
  transition: box-shadow 0.3s ease;
}
.avatar-glow-frame:hover {
  box-shadow: 0 0 15px 4px rgba(46, 204, 113, 0.6);
  animation: mc-glow 2s infinite alternate;
}
@keyframes mc-glow {
  0%   { box-shadow: 0 0 15px 4px rgba(46, 204, 113, 0.4); }
  100% { box-shadow: 0 0 25px 8px rgba(46, 204, 113, 0.8); }
}